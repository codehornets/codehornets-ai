# Marie MCP Workflow Examples

**Real-world examples of how Marie uses MCP integrations**

---

## Example 1: Weekly Class Planning

**Scenario**: Teacher wants to plan next week's intermediate ballet classes

### User Request
```
Plan next week's intermediate ballet classes. Check attendance trends and suggest focus areas.
```

### Marie's Workflow

```javascript
// 1. Query recent attendance data
const attendance = await mcp_student_database.query({
  sql: `
    SELECT
      s.name,
      COUNT(CASE WHEN a.status = 'present' THEN 1 END) as present_count,
      COUNT(*) as total_classes,
      ROUND(COUNT(CASE WHEN a.status = 'present' THEN 1 END) * 100.0 / COUNT(*), 1) as rate
    FROM students s
    JOIN enrollments e ON s.id = e.student_id
    JOIN classes c ON e.class_id = c.id
    JOIN attendance a ON s.id = a.student_id AND a.class_id = c.id
    WHERE c.name = 'Intermediate Ballet'
    AND a.date >= date('now', '-4 weeks')
    GROUP BY s.id, s.name
    ORDER BY rate DESC
  `
});

// 2. Get recent evaluation scores to identify common growth areas
const evaluations = await mcp_student_database.query({
  sql: `
    SELECT growth_areas, COUNT(*) as frequency
    FROM evaluations
    WHERE student_id IN (
      SELECT student_id FROM enrollments e
      JOIN classes c ON e.class_id = c.id
      WHERE c.name = 'Intermediate Ballet'
    )
    AND date >= date('now', '-2 months')
    GROUP BY growth_areas
  `
});

// 3. Get class schedule for next week
const schedule = await mcp_google_workspace.list_calendar_events({
  timeMin: '2025-11-25T00:00:00Z',
  timeMax: '2025-12-01T23:59:59Z',
  query: 'Intermediate Ballet'
});

// 4. Create weekly plan document
const weeklyPlan = await mcp_google_workspace.create_document({
  title: 'Intermediate Ballet - Week of Nov 25, 2025',
  content: `
# Intermediate Ballet Class Plan
## Week of November 25-30, 2025

### Class Overview
- **Attendance Trends**: ${attendance.length} students, average ${calculateAverage(attendance, 'rate')}% attendance
- **Students needing attention**: ${attendance.filter(s => s.rate < 80).map(s => s.name).join(', ')}

### Focus Areas (based on recent evaluations)
${extractCommonGrowthAreas(evaluations).map(area => `- ${area}`).join('\n')}

### Tuesday, November 26 - 5:00 PM
**Theme**: Pirouette technique and spotting
**Structure**:
- Warmup: PliÃ©s, tendus (15 min)
- Barre: Focus on relevÃ© balance, preparation for turns (20 min)
- Center: Pirouette combinations from fourth position (15 min)
- Cool down: Port de bras, stretching (10 min)

**Individual attention**:
${attendance.filter(s => s.rate < 80).map(s => `- ${s.name}: Check in about recent absences`).join('\n')}

### Thursday, November 28 - 5:00 PM
**THANKSGIVING - NO CLASS**

### Next Week Preview
Focus on petit allegro and building stamina for recital season.

---
*Generated by Marie on ${new Date().toISOString().split('T')[0]}*
  `
});

// 5. Update calendar with detailed class notes
for (const event of schedule.events) {
  if (!event.description?.includes('UPDATED')) {
    await mcp_google_workspace.update_calendar_event({
      eventId: event.id,
      description: `${event.description || ''}\n\nFocus: Pirouette technique\nSee full plan: ${weeklyPlan.url}\n\nUPDATED`
    });
  }
}

// Return result
return {
  summary: "Created weekly class plan with attendance insights and focus areas",
  documents: [weeklyPlan.url],
  attendance_summary: {
    total_students: attendance.length,
    avg_attendance_rate: calculateAverage(attendance, 'rate')
  },
  focus_areas: extractCommonGrowthAreas(evaluations)
};
```

---

## Example 2: Recital Music Analysis & Planning

**Scenario**: Teacher uploads a new recital music file and needs choreography planning

### User Request
```
Analyze /workspace/dance/music/spring-recital-2025.mp3 and create a choreography plan for intermediate jazz students
```

### Marie's Workflow

```javascript
// 1. Analyze the music file
const musicAnalysis = await mcp_audio_inspector.analyze_audio({
  file_path: '/workspace/dance/music/spring-recital-2025.mp3',
  analysis_type: 'comprehensive'
});

/*
Result:
{
  bpm: 132,
  duration: 168, // seconds
  structure: {
    intro: { start: 0, end: 8, counts: 8 },
    verse1: { start: 8, end: 40, counts: 32 },
    chorus: { start: 40, end: 72, counts: 32 },
    verse2: { start: 72, end: 104, counts: 32 },
    bridge: { start: 104, end: 120, counts: 16 },
    chorus_final: { start: 120, end: 168, counts: 48 }
  },
  total_counts: 168,
  time_signature: '4/4',
  key: 'C major',
  mood: 'upbeat, energetic'
}
*/

// 2. Query eligible students
const students = await mcp_student_database.query({
  sql: `
    SELECT s.id, s.name, s.current_level, e.technique_score, e.performance_score
    FROM students s
    JOIN enrollments en ON s.id = en.student_id
    JOIN classes c ON en.class_id = c.id
    LEFT JOIN (
      SELECT student_id, technique_score, performance_score
      FROM evaluations
      WHERE id IN (
        SELECT MAX(id) FROM evaluations GROUP BY student_id
      )
    ) e ON s.id = e.student_id
    WHERE c.style = 'jazz'
    AND s.current_level IN ('intermediate', 'intermediate-advanced')
    AND en.status = 'active'
    ORDER BY e.performance_score DESC
  `
});

// 3. Create choreography in database
const choreoResult = await mcp_student_database.execute({
  sql: `
    INSERT INTO choreography (
      piece_name, style, music_title, music_file_path,
      duration_seconds, difficulty_level, performance_date,
      event_type, notes
    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
  `,
  params: [
    'City Lights',
    'jazz',
    'Spring Recital 2025',
    '/workspace/dance/music/spring-recital-2025.mp3',
    musicAnalysis.duration,
    'intermediate',
    '2025-05-15',
    'recital',
    JSON.stringify(musicAnalysis)
  ]
});

const choreographyId = choreoResult.lastInsertRowid;

// 4. Create detailed choreography document
const choreoDoc = await mcp_google_workspace.create_document({
  title: 'City Lights - Jazz Choreography',
  content: `
# City Lights - Intermediate Jazz Choreography
## Spring Recital 2025

### Music Information
- **BPM**: ${musicAnalysis.bpm}
- **Duration**: ${Math.floor(musicAnalysis.duration / 60)}:${(musicAnalysis.duration % 60).toString().padStart(2, '0')}
- **Total Counts**: ${musicAnalysis.total_counts}
- **Time Signature**: ${musicAnalysis.time_signature}
- **Mood**: ${musicAnalysis.mood}

### Dancer Count
**${students.length} students** in intermediate jazz

### Choreography Breakdown

#### Introduction (Counts 1-8)
**Formation**: Scattered freeze positions across stage
**Movements**:
- Counts 1-4: Hold individual freeze poses
- Counts 5-6: Sharp head isolations (right, left)
- Counts 7-8: Arms reach up, body expands to formation

#### Verse 1 (Counts 9-40)
**Formation**: Two diagonal lines, stage left to stage right
**Key Movements**:
- Counts 9-12: Jazz walks forward (R, L, R, hold)
- Counts 13-16: Triple step right, pivot turn, pose
- Counts 17-20: Pas de bourrÃ©e, step touch
- Counts 21-24: Body roll, chassÃ© to right
- Counts 25-28: Kick ball change, kick ball change
- Counts 29-32: ChainÃ© turns across (4 counts), land in lunge
- Counts 33-36: Hip isolations (right, left, right, left)
- Counts 37-40: Transition to chorus formation

#### Chorus (Counts 41-72)
**Formation**: Scattered across stage, all facing front
**Key Movements**:
- Counts 41-44: Jump to second, clap, jump together
- Counts 45-48: Shoulder isolations with attitude
- Counts 49-52: Grapevine right (4 counts)
- Counts 53-56: Grapevine left (4 counts)
- Counts 57-60: Jazz square with arms
- Counts 61-64: Pirouette preparation, single turn
- Counts 65-68: Leap sequence (chassÃ©, jetÃ©, chassÃ©, pose)
- Counts 69-72: Hold pose, breathe

#### Verse 2 (Counts 73-104)
**Formation**: Circle formation
**Key Movements**:
- Counts 73-76: Step touch around circle
- Counts 77-80: Center burst (all run to center)
- Counts 81-84: Explode out (all jump back to circle)
- Counts 85-88: Individual 8-count solos (rotate spotlight)
- Counts 89-92: Continue solos
- Counts 93-96: Continue solos
- Counts 97-100: All together: hip hop groove
- Counts 101-104: Transition to bridge

#### Bridge (Counts 105-120)
**Formation**: Two lines facing each other
**Key Movements**:
- Counts 105-108: Right line: step forward, left line: step back
- Counts 109-112: Switch: left line forward, right line back
- Counts 113-116: Both lines: meet in middle, big arm movements
- Counts 117-120: Partner work: back-to-back turns

#### Final Chorus (Counts 121-168)
**Formation**: V-formation with strongest dancers in front
**Key Movements**:
- Counts 121-136: Repeat chorus choreography with more energy
- Counts 137-152: Add level changes (some dancers down, some up)
- Counts 153-160: Build to finale: everyone travels forward
- Counts 161-164: Big jumps (tour jetÃ© on count 161, 163)
- Counts 165-168: Final pose (count 165), hold with energy!

### Technical Requirements
**Jumps**: Tour jetÃ©, pas de chat, sautÃ© in second
**Turns**: Single pirouette from fourth, chainÃ© turns, back-to-back partner turns
**Isolations**: Head, shoulder, hip isolations throughout
**Difficulty Level**: Intermediate (students should have 1+ years jazz experience)

### Rehearsal Schedule
**Total Prep Time**: 20 weeks before May 15, 2025

#### Weeks 1-4 (Dec 2025)
- Learn introduction and verse 1
- Focus on clean jazz walks and isolations
- Goal: Students comfortable with first 40 counts

#### Weeks 5-8 (Jan 2026)
- Learn chorus
- Practice grapevines and jazz squares
- Introduce single pirouettes
- Goal: Know through first chorus (72 counts)

#### Weeks 9-12 (Feb 2026)
- Learn verse 2 with circle formation
- Practice individual solo moments
- Work on energy and performance quality
- Goal: Know through bridge (120 counts)

#### Weeks 13-16 (Mar-Apr 2026)
- Learn final chorus
- Add jumps and turns
- Clean synchronization
- Goal: Full routine memorized

#### Weeks 17-20 (Apr-May 2026)
- Polish details
- Full run-throughs
- Build stamina
- Add performance elements (facials, energy)
- Dress rehearsals
- Goal: Performance ready!

### Costume Suggestions
- **Color Palette**: Black and gold (city lights theme)
- **Style**: Jazz pants or skirt, sequined top
- **Hair**: High ponytail or bun
- **Makeup**: Stage makeup with gold accents

### Notes for Teacher
- Music has strong beat at ${musicAnalysis.bpm} BPM - easy for students to hear counts
- Structure is clear: intro, verse, chorus, verse, bridge, chorus
- Consider assigning solos in verse 2 based on student strengths
- Strongest dancers should be in front V-formation for final chorus
- Practice transitions between formations carefully

---
*Choreography created by Marie*
*Music analysis: ${new Date().toISOString().split('T')[0]}*
  `
});

// 5. Create casting spreadsheet
const castingSheet = await mcp_google_workspace.create_spreadsheet({
  title: 'City Lights - Casting & Tracking',
  sheets: [
    {
      name: 'Dancers',
      headers: [
        'Student Name',
        'Level',
        'Technique Score',
        'Performance Score',
        'Position/Role',
        'Costume Size',
        'Costume Received',
        'Notes'
      ],
      data: students.map(s => [
        s.name,
        s.current_level,
        s.technique_score || 'N/A',
        s.performance_score || 'N/A',
        '', // Position - to be assigned
        '', // Costume size - to be measured
        'No',
        ''
      ])
    },
    {
      name: 'Rehearsal Attendance',
      headers: ['Date', 'Week', 'Focus', ...students.map(s => s.name)],
      data: generateRehearsalDates(20).map((date, index) => [
        date,
        `Week ${Math.floor(index / 2) + 1}`,
        getRehearsalFocus(Math.floor(index / 2) + 1),
        ...students.map(() => '')
      ])
    },
    {
      name: 'Milestones',
      headers: ['Week', 'Date', 'Goal', 'Status', 'Notes'],
      data: [
        ['Week 4', '2025-12-24', 'Students know counts 1-40', 'Pending', ''],
        ['Week 8', '2026-01-21', 'Students know through first chorus (72 counts)', 'Pending', ''],
        ['Week 12', '2026-02-18', 'Students know through bridge (120 counts)', 'Pending', ''],
        ['Week 16', '2026-03-18', 'Full routine memorized', 'Pending', ''],
        ['Week 20', '2026-05-13', 'Performance ready', 'Pending', '']
      ]
    }
  ]
});

// 6. Assign students to choreography
for (const student of students) {
  await mcp_student_database.execute({
    sql: `
      INSERT INTO choreography_assignments (
        student_id, choreography_id, role, rehearsal_start_date, status
      ) VALUES (?, ?, ?, ?, ?)
    `,
    params: [
      student.id,
      choreographyId,
      'ensemble', // All start as ensemble, can assign solos later
      '2025-12-02',
      'assigned'
    ]
  });
}

// 7. Create rehearsal schedule in Google Calendar
const rehearsalDates = generateRehearsalDates(20);
for (let i = 0; i < rehearsalDates.length; i++) {
  const weekNumber = Math.floor(i / 2) + 1;
  await mcp_google_workspace.create_calendar_event({
    summary: `"City Lights" Jazz Rehearsal - Week ${weekNumber}`,
    description: `
Recital Piece: City Lights (Intermediate Jazz)
Week ${weekNumber} Focus: ${getRehearsalFocus(weekNumber)}

Choreography Document: ${choreoDoc.url}
Casting Tracker: ${castingSheet.url}

${students.length} dancers enrolled
    `,
    start: { dateTime: `${rehearsalDates[i]}T18:00:00` },
    end: { dateTime: `${rehearsalDates[i]}T18:30:00` },
    location: 'Studio B'
  });
}

// Return comprehensive result
return {
  summary: `Created complete recital choreography plan for "City Lights" with ${students.length} dancers`,
  music_analysis: {
    bpm: musicAnalysis.bpm,
    duration: musicAnalysis.duration,
    total_counts: musicAnalysis.total_counts,
    structure: Object.keys(musicAnalysis.structure).join(', ')
  },
  choreography: {
    id: choreographyId,
    document: choreoDoc.url,
    sections: 6,
    total_counts: 168
  },
  casting: {
    spreadsheet: castingSheet.url,
    dancer_count: students.length
  },
  schedule: {
    rehearsal_count: rehearsalDates.length,
    weeks: 20,
    first_rehearsal: rehearsalDates[0],
    performance_date: '2025-05-15'
  }
};
```

---

## Example 3: Student Progress Report Generation

**Scenario**: End of semester - generate progress reports for all students in a class

### User Request
```
Create end-of-semester progress reports for all students in Intermediate Ballet class
```

### Marie's Workflow

```javascript
// 1. Get all students in the class
const students = await mcp_student_database.query({
  sql: `
    SELECT
      s.id,
      s.name,
      s.birth_date,
      s.current_level,
      s.enrollment_date
    FROM students s
    JOIN enrollments e ON s.id = e.student_id
    JOIN classes c ON e.class_id = c.id
    WHERE c.name = 'Intermediate Ballet'
    AND e.status = 'active'
    ORDER BY s.name
  `
});

const reports = [];

// 2. For each student, generate comprehensive report
for (const student of students) {

  // Get attendance data
  const attendance = await mcp_student_database.query({
    sql: `
      SELECT
        date,
        status,
        notes
      FROM attendance a
      JOIN classes c ON a.class_id = c.id
      WHERE a.student_id = ?
      AND c.name = 'Intermediate Ballet'
      AND date >= date('now', '-4 months')
      ORDER BY date DESC
    `,
    params: [student.id]
  });

  const attendanceStats = {
    total: attendance.length,
    present: attendance.filter(a => a.status === 'present').length,
    absent: attendance.filter(a => a.status === 'absent').length,
    excused: attendance.filter(a => a.status === 'excused').length,
    late: attendance.filter(a => a.status === 'late').length,
    rate: attendance.length > 0
      ? (attendance.filter(a => a.status === 'present').length / attendance.length * 100).toFixed(1)
      : 0
  };

  // Get evaluation history
  const evaluations = await mcp_student_database.query({
    sql: `
      SELECT
        date,
        evaluator,
        evaluation_type,
        technique_score,
        musicality_score,
        performance_score,
        overall_score,
        strengths,
        growth_areas,
        recommendations
      FROM evaluations
      WHERE student_id = ?
      AND date >= date('now', '-4 months')
      ORDER BY date DESC
    `,
    params: [student.id]
  });

  // Get skill assessments
  const skills = await mcp_student_database.query({
    sql: `
      SELECT
        skill_category,
        skill_name,
        proficiency_level,
        score,
        date
      FROM skill_assessments
      WHERE student_id = ?
      AND date >= date('now', '-4 months')
      ORDER BY date DESC
    `,
    params: [student.id]
  });

  // Get goals progress
  const goals = await mcp_student_database.query({
    sql: `
      SELECT
        goal_text,
        goal_type,
        status,
        target_date,
        achievement_date
      FROM goals
      WHERE student_id = ?
      AND created_at >= date('now', '-4 months')
      ORDER BY status, target_date
    `,
    params: [student.id]
  });

  // Calculate progress metrics
  const improvement = evaluations.length >= 2
    ? {
        technique: evaluations[0].technique_score - evaluations[evaluations.length - 1].technique_score,
        musicality: evaluations[0].musicality_score - evaluations[evaluations.length - 1].musicality_score,
        performance: evaluations[0].performance_score - evaluations[evaluations.length - 1].performance_score
      }
    : null;

  // Create individual progress report
  const reportDoc = await mcp_google_workspace.create_document({
    title: `${student.name} - Fall 2025 Progress Report`,
    content: `
# Student Progress Report
## ${student.name}

**Class**: Intermediate Ballet
**Semester**: Fall 2025
**Report Date**: ${new Date().toISOString().split('T')[0]}
**Student Level**: ${student.current_level}
**Enrollment Date**: ${student.enrollment_date}

---

## Attendance Summary

**Overall Attendance**: ${attendanceStats.rate}%

- **Classes Attended**: ${attendanceStats.present} / ${attendanceStats.total}
- **Absences**: ${attendanceStats.absent} (${attendanceStats.excused} excused)
- **Late Arrivals**: ${attendanceStats.late}

${attendanceStats.rate >= 90 ? 'âœ… **Excellent attendance!** Consistent presence in class.' :
  attendanceStats.rate >= 80 ? 'âš ï¸ Good attendance overall. A few absences noted.' :
  'âš ï¸ Attendance could be improved. Regular attendance helps with progress.'}

---

## Technical Assessment

${evaluations.length > 0 ? `
### Most Recent Evaluation (${evaluations[0].date})
**Evaluator**: ${evaluations[0].evaluator}

**Scores** (out of 10):
- **Technique**: ${evaluations[0].technique_score}/10
- **Musicality**: ${evaluations[0].musicality_score}/10
- **Performance Quality**: ${evaluations[0].performance_score}/10
- **Overall**: ${evaluations[0].overall_score}/10

${improvement ? `
### Progress This Semester
${improvement.technique > 0 ? `âœ… Technique: +${improvement.technique} points` :
  improvement.technique < 0 ? `Technique: ${improvement.technique} points` :
  'Technique: Consistent'}
${improvement.musicality > 0 ? `âœ… Musicality: +${improvement.musicality} points` :
  improvement.musicality < 0 ? `Musicality: ${improvement.musicality} points` :
  'Musicality: Consistent'}
${improvement.performance > 0 ? `âœ… Performance: +${improvement.performance} points` :
  improvement.performance < 0 ? `Performance: ${improvement.performance} points` :
  'Performance: Consistent'}
` : ''}

### Strengths
${evaluations[0].strengths || 'No specific strengths noted yet.'}

### Areas for Growth
${evaluations[0].growth_areas || 'Continue developing all areas.'}

### Recommendations
${evaluations[0].recommendations || 'Keep up the great work!'}
` : 'No formal evaluations this semester.'}

---

## Skill Development

${skills.length > 0 ? `
${groupSkillsByCategory(skills).map(category => `
### ${category.name}
${category.skills.map(skill => `
- **${skill.skill_name}**: ${skill.proficiency_level} (${skill.score}/10)
  *Assessed: ${skill.date}*
`).join('\n')}
`).join('\n')}
` : 'Detailed skill assessments coming soon.'}

---

## Goals Progress

${goals.length > 0 ? `
${goals.map(goal => `
${goal.status === 'achieved' ? 'âœ…' : 'ðŸŽ¯'} **${goal.goal_text}**
  - Status: ${goal.status}
  - Target: ${goal.target_date || 'Ongoing'}
  ${goal.achievement_date ? `- Achieved: ${goal.achievement_date}` : ''}
`).join('\n')}
` : 'Goals will be set in individual meetings.'}

---

## Teacher Comments

${generatePersonalizedComments(student, evaluations, attendance, skills)}

---

## Next Steps for Spring Semester

${generateNextSteps(student, evaluations, skills, goals)}

---

## Parent-Teacher Conference

We welcome the opportunity to discuss ${student.name}'s progress in more detail.
Please contact the studio to schedule a conference if you have questions or would like to discuss this report.

---

*This report was generated by Marie, Dance Teaching Assistant*
*For questions, please contact the studio director*
    `
  });

  // Add report URL to database
  await mcp_student_database.execute({
    sql: `
      INSERT INTO communications (
        student_id,
        communication_type,
        subject,
        content,
        sent_by,
        date
      ) VALUES (?, ?, ?, ?, ?, ?)
    `,
    params: [
      student.id,
      'email',
      `Fall 2025 Progress Report - ${student.name}`,
      `Progress report link: ${reportDoc.url}`,
      'Marie (AI Assistant)',
      new Date().toISOString().split('T')[0]
    ]
  });

  reports.push({
    student_name: student.name,
    student_id: student.id,
    report_url: reportDoc.url,
    attendance_rate: attendanceStats.rate,
    latest_overall_score: evaluations[0]?.overall_score || null,
    improvement: improvement
  });
}

// 3. Create master summary spreadsheet
const summarySheet = await mcp_google_workspace.create_spreadsheet({
  title: 'Intermediate Ballet - Fall 2025 Progress Summary',
  sheets: [{
    name: 'Class Overview',
    headers: [
      'Student',
      'Attendance %',
      'Latest Overall Score',
      'Technique Improvement',
      'Report Link'
    ],
    data: reports.map(r => [
      r.student_name,
      r.attendance_rate,
      r.latest_overall_score || 'N/A',
      r.improvement ? `${r.improvement.technique > 0 ? '+' : ''}${r.improvement.technique}` : 'N/A',
      r.report_url
    ])
  }]
});

// 4. Schedule parent-teacher conferences
const conferenceSlots = generateConferenceSlots(
  '2025-12-09', // Start date
  '2025-12-13', // End date
  30 // Minutes per conference
);

for (let i = 0; i < Math.min(reports.length, conferenceSlots.length); i++) {
  await mcp_google_workspace.create_calendar_event({
    summary: `Parent Conference - ${reports[i].student_name}`,
    description: `
Discuss Fall 2025 progress for ${reports[i].student_name}

Progress Report: ${reports[i].report_url}

Attendance: ${reports[i].attendance_rate}%
Latest Score: ${reports[i].latest_overall_score}/10

Topics to discuss:
- Semester progress and achievements
- Areas for continued development
- Spring semester goals
- Questions from parents
    `,
    start: { dateTime: conferenceSlots[i].start },
    end: { dateTime: conferenceSlots[i].end },
    location: 'Studio Office',
    attendees: [
      { email: getParentEmail(reports[i].student_id) }
    ]
  });
}

// Return summary
return {
  summary: `Generated ${reports.length} individual progress reports and scheduled ${conferenceSlots.length} parent conferences`,
  class: 'Intermediate Ballet',
  semester: 'Fall 2025',
  reports_created: reports.length,
  summary_spreadsheet: summarySheet.url,
  conferences_scheduled: Math.min(reports.length, conferenceSlots.length),
  class_stats: {
    avg_attendance: (reports.reduce((sum, r) => sum + parseFloat(r.attendance_rate), 0) / reports.length).toFixed(1),
    avg_score: reports.filter(r => r.latest_overall_score).length > 0
      ? (reports.reduce((sum, r) => sum + (r.latest_overall_score || 0), 0) /
         reports.filter(r => r.latest_overall_score).length).toFixed(1)
      : 'N/A',
    students_improving: reports.filter(r => r.improvement && r.improvement.technique > 0).length
  },
  individual_reports: reports.map(r => ({
    student: r.student_name,
    url: r.report_url
  }))
};
```

---

## Helper Functions

```javascript
// Helper: Generate rehearsal dates
function generateRehearsalDates(weeks) {
  const dates = [];
  const startDate = new Date('2025-12-02');
  // Rehearsals on Tuesday and Thursday
  for (let i = 0; i < weeks * 2; i++) {
    const date = new Date(startDate);
    const daysToAdd = Math.floor(i / 2) * 7 + (i % 2 === 0 ? 0 : 2); // Tue=0, Thu=2
    date.setDate(startDate.getDate() + daysToAdd);
    dates.push(date.toISOString().split('T')[0]);
  }
  return dates;
}

// Helper: Get rehearsal focus by week
function getRehearsalFocus(weekNumber) {
  if (weekNumber <= 4) return 'Learn introduction and verse 1';
  if (weekNumber <= 8) return 'Learn chorus, practice formations';
  if (weekNumber <= 12) return 'Learn verse 2 and bridge';
  if (weekNumber <= 16) return 'Learn final chorus, full run-throughs';
  return 'Polish, clean, performance prep';
}

// Helper: Group skills by category
function groupSkillsByCategory(skills) {
  const categories = {};
  skills.forEach(skill => {
    if (!categories[skill.skill_category]) {
      categories[skill.skill_category] = {
        name: skill.skill_category,
        skills: []
      };
    }
    categories[skill.skill_category].skills.push(skill);
  });
  return Object.values(categories);
}

// Helper: Generate personalized comments
function generatePersonalizedComments(student, evaluations, attendance, skills) {
  let comments = [];

  // Attendance-based comments
  if (parseFloat(attendance.rate) >= 95) {
    comments.push(`${student.name} demonstrates exceptional commitment with ${attendance.rate}% attendance.`);
  } else if (parseFloat(attendance.rate) < 80) {
    comments.push(`More consistent attendance would help ${student.name} progress even faster.`);
  }

  // Evaluation-based comments
  if (evaluations.length > 0 && evaluations[0].overall_score >= 9) {
    comments.push(`${student.name} is excelling in ballet technique and shows great potential.`);
  }

  // Add specific strengths
  if (evaluations.length > 0 && evaluations[0].strengths) {
    comments.push(`Notable strengths include: ${evaluations[0].strengths.toLowerCase()}`);
  }

  return comments.join(' ');
}

// Helper: Generate next steps
function generateNextSteps(student, evaluations, skills, goals) {
  const steps = [];

  // Based on current level
  if (student.current_level === 'intermediate') {
    steps.push('Continue building strong ballet foundation');
    steps.push('Consider adding pointe readiness class in Spring');
  }

  // Based on evaluations
  if (evaluations.length > 0 && evaluations[0].recommendations) {
    steps.push(evaluations[0].recommendations);
  }

  // Default
  if (steps.length === 0) {
    steps.push('Continue regular class attendance');
    steps.push('Set new goals for Spring semester');
  }

  return steps.map(step => `- ${step}`).join('\n');
}

// Helper: Get parent email (would query contacts table)
function getParentEmail(studentId) {
  // In real implementation:
  // const contact = await mcp_student_database.query({
  //   sql: "SELECT email FROM contacts WHERE student_id = ? AND is_primary = 1 LIMIT 1",
  //   params: [studentId]
  // });
  // return contact[0]?.email;

  return 'parent@example.com'; // Placeholder
}

// Helper: Generate conference time slots
function generateConferenceSlots(startDate, endDate, durationMinutes) {
  const slots = [];
  const currentDate = new Date(startDate);
  const endDateTime = new Date(endDate);

  // Conference hours: 3pm - 7pm weekdays
  while (currentDate <= endDateTime) {
    if (currentDate.getDay() >= 1 && currentDate.getDay() <= 5) { // Weekday
      for (let hour = 15; hour < 19; hour++) { // 3pm - 7pm
        for (let minute = 0; minute < 60; minute += durationMinutes) {
          const start = new Date(currentDate);
          start.setHours(hour, minute, 0);
          const end = new Date(start);
          end.setMinutes(end.getMinutes() + durationMinutes);

          slots.push({
            start: start.toISOString(),
            end: end.toISOString()
          });
        }
      }
    }
    currentDate.setDate(currentDate.getDate() + 1);
  }

  return slots;
}
```

---

## Summary

These examples show how Marie leverages MCP integrations to:

1. **Database Operations** (mcp_student_database)
   - Complex SQL queries for student data
   - Attendance tracking and analysis
   - Evaluation history retrieval
   - Goal and skill tracking

2. **Audio Analysis** (mcp_audio_inspector)
   - BPM and tempo detection
   - Music structure identification
   - Count mapping for choreography

3. **Document Generation** (mcp_google_workspace)
   - Professional evaluation reports
   - Choreography documentation
   - Progress tracking spreadsheets
   - Parent communications

4. **Calendar Management** (mcp_google_workspace)
   - Class scheduling
   - Rehearsal planning
   - Parent conference booking
   - Event coordination

All orchestrated through Marie's autonomous task processing workflow!

---

**Version**: 1.0
**Last Updated**: 2025-11-18
